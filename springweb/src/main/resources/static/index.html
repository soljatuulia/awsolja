<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html>
    <head>
        <title>Kirjailijat</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script>
            
            let servicesRoot = "";
    
            function makeTheCall(url, method, data) {
                return new Promise(function (resolve, reject) {
                    let x = new XMLHttpRequest();
                    x.onreadystatechange = function () {
                        if (x.readyState == 4) {
                            try {
                                let obj = JSON.parse(x.responseText);
                                resolve(obj);
                            } catch (ex) {
                                reject(x);
                            }
                        }
                        ;
                    }
                    x.open(method, servicesRoot + url, true);
                    x.setRequestHeader("Content-Type", "application/json");
                    x.setRequestHeader("Accept", "application/json");
                    x.send(data && JSON.stringify(data));
                });
            }

            let HTTP = {
                get: url => makeTheCall(url, "get"),
                put: (url, data) => makeTheCall(url, "put", data),
                post: (url, data) => makeTheCall(url, "post", data),
                delete: (url) => makeTheCall(url, "delete")
            };
            

            function fillAuthors() {
                HTTP.get("/authors").then(authors => {
                    let html = '';
                    authors.forEach(author => {
                        html += `<option value="${author.id}">${author.firstName+' '+author.lastName}</option>`;
                    });
                    document.getElementById("authors").innerHTML = html;
                });
            }

            function getAuthor(id){
                HTTP.get("/authors/"+id).then(author => {
                    document.getElementById("id").value=author.id;
                    document.getElementById("firstname").value=author.firstName; 
                    document.getElementById("lastname").value=author.lastName;
                });
            }    
    
            function selectedChange(){
                let id=document.getElementById("authors").value;
                getAuthor(id);
            }
    
            function saveClicked(){
                let id=document.getElementById("id").value;
                let firstName=document.getElementById("firstname").value;
                let lastName=document.getElementById("lastname").value;
                let author={id,firstName,lastName};
                let author2={"id":id,firstName,lastName};               
                HTTP.put("/authors/"+id,author).then(a => {
                    console.log("Author saved");
                    fillAuthors();
                });
            }    
            
            window.onload = function () {
                fillAuthors();
                document.getElementById("authors").addEventListener("change", selectedChange);
                document.getElementById("searchButton").addEventListener("click", searchClicked);
            }
            
        </script>
    </head>
    <body>
        <div class="container">
            <header>
                <!-- <img src="logo.png" alt="filename" align="center"/> -->
                <h1>Kirjailijasovellus</h1>
            </header>
            <!-- 
            <nav>
                <a href="index.html">Tähän linkkejä</a>
            </nav> 
            --> 
            <main>
                <section class="form">
                    <input type="hidden" id="id" />
                    <div class="input">
                        <label for="firstname">Author first name</label>
                        <input id="firstName" />
                    </div>
                    <div class="input">
                        <label for="lastname">Author last name</label>
                        <input id="lastName" />
                    </div>
                    <div class="buttons">
                        <input id="saveButton" type="button" value="Save" />
                        <input type="button" value="Delete" />
                    </div>
                </section>
                <section>
                    <select id ="authors" size="8"></select>
                </section>
            </main>
        </div>
    </body>
</html>
